@using JD.BitBet.BL.Models
@model List<JD.BitBet.BL.Models.GameState>
@{
    ViewBag.Title = "Blackjack Game";
    var loggedInUserId = ViewBag.UserId as string;
    var game = ViewBag.GameDetails as Game;
}

<h1 class="game-title">Blackjack Game</h1>

@if(ViewBag.GameDetails == null)
{
    <p class="error-message">Game details null</p>

}
@if (ViewBag.Error != null)
{
    <p class="error-message">@ViewBag.Error</p>
}
else if (Model != null && Model.Any())
{
    <div class="game-section">
        <h3 class="section-title">Dealer's Hand</h3>
        <!-- Display only one dealerHandVal -->
        <p class="score"><strong>Dealer's Score:</strong> @Model[0].dealerHandVal</p>
    </div>

    @foreach (var gameState in Model)
    {
        <!-- Only display content for the logged-in user -->
            <div class="game-container">
                <h2 class="game-status">Current Game Status: @gameState.message</h2>

                <div class="game-section">
                    <h3 class="section-title">Your Hand</h3>
                    <p class="score"><strong>Your Score:</strong> @gameState.playerHandVal</p>
                </div>
                <div class="action-buttons">
                    @if (gameState.UserId.ToString() == loggedInUserId)
                    {
                        @if(!gameState.isGameOver)
                        {
                            <form asp-action="Hit" method="post" class="action-form">
                                <button type="submit" class="action-button hit-button">Hit</button>
                            </form>

                            <form asp-action="Stand" method="post" class="action-form">
                                <button type="submit" class="action-button stand-button">Stand</button>
                            </form>

                            <form asp-action="Double" method="post" class="action-form">
                                <button type="submit" class="action-button double-button">Double</button>
                            </form>
                        }
                        @if(game.isGameOver){
                            <p class="game-over">Game over! Click below to start a new game:</p>

                            <form asp-action="Start" method="post" class="action-form">
                                <button type="submit" class="action-button start-button">Start New Game</button>
                            </form>

                            <!-- Leave Game Button -->
                            <form asp-action="LeaveGame" method="post" class="action-form">
                                <button type="submit" class="action-button leave-button">Leave Game</button>
                            </form>

                            <!-- Bet Amount Incrementer -->
                            <div class="bet-amount">
                                <label for="betAmount">Bet Amount: </label>
                                <button type="button" class="bet-incrementer" onclick="adjustBet(1)">+1</button>
                                <button type="button" class="bet-incrementer" onclick="adjustBet(5)">+5</button>
                                <button type="button" class="bet-incrementer" onclick="adjustBet(10)">+10</button>
                                <button type="button" class="bet-incrementer" onclick="adjustBet(50)">+50</button>
                                <button type="button" class="bet-incrementer" onclick="adjustBet(100)">+100</button>

                                <input type="number" id="betAmount" name="betAmount" value="0" min="0" step="1" readonly />
                            </div>

                            <script>
                                let betAmount = 0;

                                function adjustBet(amount) {
                                    betAmount += amount;
                                    document.getElementById("betAmount").value = betAmount;
                                }
                            </script>
                        }
                    }
                </div>
        </div>
    }
}
else
{
    <div class="game-container">
        <p class="welcome-message">Welcome to Blackjack! Click below to start a new game:</p>
        <form asp-action="Start" method="post" class="action-form">
            <button type="submit" class="action-button start-button">Start Game</button>
        </form>
    </div>
}